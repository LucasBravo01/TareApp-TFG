<!DOCTYPE html>
<html lang="es">

<head>
    <%- include("../public/utils/head.html") %>
    <!-- Importar CSS específicos -->
    <link rel="stylesheet" href="/css/<%= session.currentUser.configuration.theme %>/style.css">
    <!-- Importar JS específicos -->
    <script src="/js/createTask.js"></script>
</head>

<body data-response="<%= JSON.stringify(response) %>" data-task="<%= JSON.stringify(task) %>">
    <!-- Importar modal error -->
    <%- include("../public/utils/modal.html") %>
    <!-- Importar nav -->
    <%- include("fragments/nav", { generalInfo: generalInfo }) %>
    <!-- Botón para volver atrás -->
    <%- include("fragments/back", { theme: session.currentUser.configuration.theme }) %>

    <div class="container">
        <div class="d-flex justify-content-center">
            <h1 class="title">
                <% if (task.id) { %>
                    MOSTRAR TAREA
                <% } else { %>
                    CREAR TAREA
                <% } %>
            </h1>
        </div>

        <form id="formTask" action="/tareas/crearTareaForm" method="post">
            <div class="row justify-content-center mt-3 mb-3">
                <input type="hidden" id="input-id-task" name="id-task" value="<%= task.id %>">
                <input type="hidden" id="input-id-user" name="id" value="<%= session.currentUser.id %>">

                <!--TITULO-->
                <div class="col-6 text-center mt-3">
                    <label for="input-title">Título</label>
                    <input type="text" id="input-title" name="title" class="form-control mt-1" value="<%= task.title %>">
                </div>

                <!--PROPIETARIO-->
                <div class="col-3 text-center mt-3">
                    <% if (session.currentUser.hasProfilePic) { %>
                        <button id="button-nav-profile" title="Desplegable del perfil" class="ms-1" style="border-radius: 50%;" disabled>
                            <img id="img-nav-profile" class="user-pic" src="/usuario/fotoPerfil/<%= session.currentUser.id %>" alt="Foto de perfil" width="50">
                        </button>
                    <% } else { %>
                        <button id="button-nav-profile" title="Desplegable del perfil" class="ms-1" style="border-radius: 50%;" disabled>
                            <img id="img-nav-profile" src="/images/<%= session.currentUser.configuration.theme %>/default-user.png" alt="Foto de perfil" width="50">
                        </button>
                    <% } %>
                    <% if (session.currentUser) { %>
                        <p class="ms-3">
                            <%=session.currentUser.name%>
                        </p>
                    <% }else{ %>
                        <p>Propietario</p>
                    <% } %>
                </div>

                <!--TAREA COMPLETADA-->
                <div class="col-3 text-center mt-3">
                    <% if (task.id) { %>
                        <label for="input-completed">Completar tarea</label>
                        <input id="input-completed" name="completed" type="checkbox" <%= task.done ? 'checked' : '' %>>
                    <% } %>
                </div>

                <!--FECHA DE ENTREGA-->
                <div class="col-6 text-center mt-3">
                    <label for="input-date">Fecha de entrega</label>
                    <input type="date" id="input-date" name="date" class="form-control" value="<%= task.date %>">  
                </div>

                <!--HORA DE ENTREGA-->
                <div class="col-6 text-center mt-3">
                    <label for="input-hour">Hora:</label>
                    <input type="time" id="input-hour" name="time" class="form-control" value="<%= task.time %>">
                </div>

                <!--CATEGORIA-->
                <div class="col-4 text-center mt-3">
                    <label for="input-category">Categoria</label>
                    <select id="input-category" name="category" class="form-control">
                        <option value="">...</option>
                        <% data.categories.forEach( c=> { %>
                            <option value="<%= c.name %>"><% if (session.currentUser.configuration.theme === "alegre") { %> <%- c.category_icon %> <% } %> <%= c.name %></option>
                        <% }); %>
                    </select>
                </div>
    
                <!--ASIGNATURA-->
                <div class="col-4 text-center mt-3">
                    <label for="input-subject">Asignatura</label>
                    <select id="input-subject" name="subject" class="form-control" disabled>
                        <option value="">...</option>
                        <% data.subjects.forEach( s=> { %>
                            <option value="<%= s.id %>"><% if (session.currentUser.configuration.theme === "alegre") { %> <%- s.subject_icon %> <% } %> <%= s.name %></option>
                        <% }); %>
                    </select>
                </div>

                <!--RECORDATORIOS-->
                <div class="col-4 text-center mt-3">
                    <label for="input-reminder">Recordatorios</label>
                    <select id="input-reminder" name="reminders" class="form-control">
                        <option value="1 día antes">1 día antes</option>
                        <option value="Desde 2 días antes">Desde 2 días antes</option>
                        <option value="Desde 1 semana antes">Desde 1 semana antes</option>
                        <option value="No recordarmelo">No recordarmelo</option>
                    </select>
                </div>

                <!--DESCRIPCIÓN-->
                <div class="col-12 text-center mt-3">
                    <label for="input-description">Descripción</label>
                    <textarea id="input-description" name="description" rows="4" class="form-control"><%= task.description %></textarea>
                </div>

                <!--RECOMPENSA-->
                <div class="col-4 text-center mt-3">
                    <label for="input-reward">Recompensa</label>
                    <select id="input-reward" name="reward" class="form-control">
                        <option value="">...</option>
                        <% data.rewards.forEach( r=> { %>
                            <option value="<%= r.id %>"><%= r.title %></option>
                        <% }); %>
                    </select>
                </div>

                <!--DURACIÓN ESTIMADA-->
                <div class="col-4 text-center mt-3">
                    <label for="input-duration">Duracion estimada</label>
                    <select id="input-duration" name="duration" class="form-control">
                        <option value="no lo sé">No lo sé</option>
                        <option value="corta">Corta</option>
                        <option value="media">Media</option>
                        <option value="larga">Larga</option>
                    </select>
                </div>

                <!--BOTÓN CREAR TAREA-->
                <div class="col-6 text-center mt-5">
                    <% if (task.id) { %>
                    <% } else { %>
                        <button type="submit" id="input-sb-createTask" class="main-button">Crear Tarea</button>
                    <% } %>
                </div>
            </div>
        </form>
    </div>
</body>

</html>